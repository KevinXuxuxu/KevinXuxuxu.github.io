<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link id="spectre" rel="stylesheet" href="/static/style/spectre.css">
    <link rel="stylesheet" href="/static/style/pygments_style.css">
    <link rel="stylesheet" href="/static/style/custom.css">
    <script>
        window.addEventListener('load', function () { window.loaded = true; });
    </script>

    <script src="/static/script/color_theme.js"></script>
    <script>
        init_color_theme();

        // Manual responsive for blog images
        document.addEventListener("DOMContentLoaded", function () {
            if (window.innerWidth < 768) {
                const elements = document.getElementsByClassName("my-resp-img");
                for (var i = 0; i < elements.length; i++) {
                    elements[i].style.width = "90%";
                }
            }
        });
    </script>

    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
<title>cosmo: 3D Graphics Engine in Terminal (Cont.)</title>

<style>
    /* Initially hide the element */
    .hidden {
        display: none;
    }

    /* Show the element when it's hovered over */
    h3:hover .hidden {
        display: inline-block;
    }

    h4:hover .hidden {
        display: inline-block;
    }

    h5:hover .hidden {
        display: inline-block;
    }
</style>

<link rel="stylesheet" href="/static/style/cosmo.css">
<script type="module" src="/static/script/cosmo_load.js"></script>


    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="/static/favicon_io/site.webmanifest">
</head>

<body>
    <div class="main container grid-lg">
        <header class="navbar" style="margin-bottom: 2.5em;">
            <section class="navbar-section">
            </section>
            <section class="navbar-section">
                <label id="color-switch" class="form-switch">
                    <input id="theme-checkbox" type="checkbox" onclick="switch_color_theme();" disabled>
                    <i class="form-icon"></i> <span id="moon">⏳</span>
                </label>
                <a href="https://github.com/KevinXuxuxu"><svg height="1.1em" width="1.1em" viewBox="0 0 32 32"
                        class="nav-icon" xml:space="preserve">
                        <title>Github</title>
                        <path clip-rule="evenodd"
                            d="M16.003,0C7.17,0,0.008,7.162,0.008,15.997  c0,7.067,4.582,13.063,10.94,15.179c0.8,0.146,1.052-0.328,1.052-0.752c0-0.38,0.008-1.442,0-2.777  c-4.449,0.967-5.371-2.107-5.371-2.107c-0.727-1.848-1.775-2.34-1.775-2.34c-1.452-0.992,0.109-0.973,0.109-0.973  c1.605,0.113,2.451,1.649,2.451,1.649c1.427,2.443,3.743,1.737,4.654,1.329c0.146-1.034,0.56-1.739,1.017-2.139  c-3.552-0.404-7.286-1.776-7.286-7.906c0-1.747,0.623-3.174,1.646-4.292C7.28,10.464,6.73,8.837,7.602,6.634  c0,0,1.343-0.43,4.398,1.641c1.276-0.355,2.645-0.532,4.005-0.538c1.359,0.006,2.727,0.183,4.005,0.538  c3.055-2.07,4.396-1.641,4.396-1.641c0.872,2.203,0.323,3.83,0.159,4.234c1.023,1.118,1.644,2.545,1.644,4.292  c0,6.146-3.74,7.498-7.304,7.893C19.479,23.548,20,24.508,20,26c0,2,0,3.902,0,4.428c0,0.428,0.258,0.901,1.07,0.746  C27.422,29.055,32,23.062,32,15.997C32,7.162,24.838,0,16.003,0z"
                            fill="#181616" fill-rule="evenodd" />
                        <g />
                        <g />
                        <g />
                        <g />
                        <g />
                        <g />
                    </svg></a>
                <a href="/feed.xml"><svg height="1.1em" width="1.1em" viewBox="0 0 20 22" xml:space="preserve"
                        class="nav-icon">
                        <title>RSS feed</title>
                        <path
                            d="M6.002,15.999C4.895,15.999,3.998,16.896,4,18c0,1.104,0.896,2.001,2.002,1.999C7.105,20.001,8.002,19.105,8,18  C8.002,16.893,7.105,15.997,6.002,15.999z" />
                        <path
                            d="M6,4C4.896,4,4,4.896,4,6s0.896,2,2,2c5.514,0,10,4.486,10,10c0,1.104,0.896,2,2,2s2-0.896,2-2C20,10.28,13.72,4,6,4z" />
                        <path
                            d="M6,10c-1.104,0-2,0.896-2,2s0.896,2,2,2c2.205,0,4,1.794,4,4c0,1.104,0.896,2,2,2s2-0.896,2-2C14,13.589,10.411,10,6,10z" />
                    </svg></a>
            </section>
        </header>
        <header class="column col-sm-12 col-md-10 col-8">
            
<figure class="avatar avatar-sm">
    <img src="/static/favicon_io/android-chrome-192x192.png" alt="avatar">
</figure>&nbsp;
<a href="/">fzxu's Blog</a>
<h1 class="heading-index">cosmo: 3D Graphics Engine in Terminal (Cont.)</h1>

<p class="text-gray">
    <small>2024-09-14 21:49:44</small>
    <span class="chip bg-secondary"><a href="/blog/category/tech/" class="text-primary">tech</a></span>
    
    <span class="chip bg-gray"><a href="/blog/tag/Computer Graphics/" class="text-dark">Computer Graphics</a></span>
    
    <span class="chip bg-gray"><a href="/blog/tag/Ray Tracing/" class="text-dark">Ray Tracing</a></span>
    
    <span class="chip bg-gray"><a href="/blog/tag/Rust/" class="text-dark">Rust</a></span>
    
    <span class="chip bg-gray"><a href="/blog/tag/Terminal/" class="text-dark">Terminal</a></span>
    
</p>

        </header>

        <main class="content columns">
            <div class="column col-sm-12 col-md-10 col-8">
                

<p><p style="text-align: center"><img class="my-resp-img" src="/static/image/cosmo_david.gif" alt="cosmo_david" style="width: 50%"/><br><em class="text-gray">David Head Rendered in 24FPS</em></p></p>
<!-- <pre><code class="cosmo-display" scene="david" stl-names="david_oriented" dimension="120,60" framerate="24" enable-aabb=true disable-shade=true>loading failed, try refresh UwU</code></pre> -->
<p>This is a continuation of <a href="/blog/post/cosmo:-3D-Graphics-Engine-in-Terminal/">the previous post</a>, where we talked about my side project <a href="https://github.com/KevinXuxuxu/cosmo">cosmo</a> and partly about details to implement a basic 3D graphics engine in terminal. In this post we're going to cover the rest parts of implementing a basic PoC (<em>Spinning Cube™</em>).</p>
<h4 id="camera">Camera&nbsp;<a class="hidden" tabindex="-1" href="#camera" style="font-size: .8rem"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 8 8"><path fill="currentColor" d="M5.88.03a1.9 1.9 0 0 0-.53.09c-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22c.35-.12.78-.07 1.06.22c.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47c-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5A1.98 1.98 0 0 0 6.44.07C6.26.03 6.06.03 5.88.04zm-2 2.31c-.5-.02-1.19.15-1.78.75L.6 4.59a1.98 1.98 0 0 0 0 2.81c.56.56 1.36.72 2.06.47c.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22c-.35.12-.78.07-1.06-.22c-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44c.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"/></svg></a></h4>
<p>To see, is to have many light rays collected onto your retina. Here we're doing the opposite (as discussed in the <a href="/blog/post/cosmo:-3D-Graphics-Engine-in-Terminal/#ray_tracing">Ray Tracing</a> section last time), determine a set of light rays going out, based on the type of camera we're using.</p>
<ul>
<li>Orthogonal: all light rays are parallel to each other, so that visual scale is not related to how far the objects are from the camera. This is not natural to our eyes, but quite unique taste in video games (e.g. <a href="https://en.wikipedia.org/wiki/Monument_Valley_(video_game)">Monument Valley</a>, <a href="https://en.wikipedia.org/wiki/Tunic_(video_game)">Tunic</a>) and cinematography (e.g. movies by <a href="https://en.wikipedia.org/wiki/Wes_Anderson">Wes Anderson</a>)</li>
<li>Perspective: All light rays are shooting from <a href="https://en.wikipedia.org/wiki/Focus_(optics)">a single point</a>. This is closest to our natural experience and result of most medias.</li>
<li>Other types like fisheye, 360-degrees etc.</li>
</ul>
<p>For our basic PoC, we'll implement the orthogonal camera as it's probably the easiest one. To determine such a camera in 3D space, we need a grid of points (pixels on the &quot;film&quot;) and a direction. The grid of points can then be further abstracted into the center point of the &quot;film&quot; and the size (width, height) of it. For further simplicity, we fix the camera's direction to be along the negative direction of x-axis<sup class="footnote-ref" id="fnref-1"><a href="#fn-1">1</a></sup>. The implementation is something like this:</p>
<div class="highlight">
    <pre class="code" data-lang="rust"><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Camera</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">rays</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Ray</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Camera</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">w</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">h</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span>: <span class="kt">f32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">rays</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Ray</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">h</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">rays</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[]);</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">h</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">f32</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">f32</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">w</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">f32</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">f32</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">scale</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">rays</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">push</span><span class="p">(</span><span class="n">Ray</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">p</span>: <span class="nc">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">),</span><span class="w"></span>
<span class="w">                    </span><span class="n">d</span>: <span class="nc">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="p">});</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">Camera</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">rays</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre>
</div><p>A few points to notice:</p>
<ul>
<li>We're using a custom struct <code>Ray</code>, which is just an encapsulation of a point and a direction, both represented by <code>glam::Vec3</code>.</li>
<li>We also added a <code>scale</code> parameter, because the width and height here are integer values representing the discrete number of pixels, we also need a way to scale (&quot;zoom&quot;) without changing the resolution.</li>
<li>There's an extra <code>* 2.</code> for the <code>z</code> coordinate, this is to compensate for the character width-height-ratio in the terminal. For what I'm using (VS code) it's 2.</li>
</ul>
<p>Now is a good time to start building our &quot;cube&quot; object with some triangles (12 triangles to be specific). To achieve the orientation like <a href="/static/image/cosmo_basic.gif">this</a> a good amount of calculation is needed, so here's my version of it:</p>
<div class="highlight">
    <pre class="code" data-lang="rust"><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">8.660254</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">8.660254</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="mf">8.164965</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">2.886751</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="o">-</span><span class="mf">4.082483</span><span class="p">,</span><span class="w"> </span><span class="mf">7.071067</span><span class="p">,</span><span class="w"> </span><span class="mf">2.886751</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="o">-</span><span class="mf">4.082483</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">7.071067</span><span class="p">,</span><span class="w"> </span><span class="mf">2.886751</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="mf">4.082483</span><span class="p">,</span><span class="w"> </span><span class="mf">7.071067</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">2.886751</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="o">-</span><span class="mf">8.164965</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">2.886751</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="mf">4.082483</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">7.071067</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">2.886751</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">triangles</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Triangle</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">G</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">G</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">G</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">G</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">),</span><span class="w"></span>
<span class="p">];</span><span class="w"></span>
</code></pre>
</div><p>With that, we can make the <code>Player</code> object take in <code>triangles</code> and a <code>Camera</code> object, and update the screen based on what the camera can see:</p>
<div class="highlight">
    <pre class="code" data-lang="rust"><span></span><code><span class="c1">// ...</span>
<span class="k">impl</span><span class="w"> </span><span class="n">Player</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Add triangles and camera</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">w</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">h</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">fr</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">triangles</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Triangle</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span>: <span class="nc">Camera</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="fm">vec!</span><span class="p">[</span><span class="sc">&#39; &#39;</span><span class="p">;</span><span class="w"> </span><span class="n">w</span><span class="p">];</span><span class="w"> </span><span class="n">h</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">fr</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">f32</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Player</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">triangles</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">update</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="bp">self</span><span class="p">.</span><span class="n">h</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">triangles</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                     </span><span class="k">match</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">intersect</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">camera</span><span class="p">.</span><span class="n">rays</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="nb">Some</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="bp">self</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;.&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">                            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">                        </span><span class="p">},</span><span class="w"></span>
<span class="w">                        </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{},</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// other functions ...</span>
<span class="p">}</span><span class="w"></span>
</code></pre>
</div><p>The logic is pretty simple: for each pixel assume blank at beginning, then go over all the triangles and put a dot when an intersection happens, and break early. This works in our cube case because we only have one object in the scene, so one ray cannot intersect 2 triangles both on the positive side<sup class="footnote-ref" id="fnref-2"><a href="#fn-2">2</a></sup>.</p>
<p>With what we already have and some additional code in <code>main.rs</code> to connect everything together, we can do <code>cargo run</code> and get a still frame of this:</p>
<p><p style="text-align: center"><img class="my-resp-img" src="/static/image/cosmo_first_cube.png" alt="cosmo_first_cube" style="width: 40%"/><br><em class="text-gray">Initial Result</em></p></p>
<p>This is not that exciting and a bit stupid, but this is clearly correct and does look like the shadow of a standing cube. You can get it from <a href="https://github.com/KevinXuxuxu/cosmo/tree/lite_v1/rust_lite">this brach</a> of the code, and feel free to play with the camera parameters to check the effects.</p>
<h4 id="lighting">Lighting&nbsp;<a class="hidden" tabindex="-1" href="#lighting" style="font-size: .8rem"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 8 8"><path fill="currentColor" d="M5.88.03a1.9 1.9 0 0 0-.53.09c-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22c.35-.12.78-.07 1.06.22c.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47c-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5A1.98 1.98 0 0 0 6.44.07C6.26.03 6.06.03 5.88.04zm-2 2.31c-.5-.02-1.19.15-1.78.75L.6 4.59a1.98 1.98 0 0 0 0 2.81c.56.56 1.36.72 2.06.47c.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22c-.35.12-.78.07-1.06-.22c-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44c.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"/></svg></a></h4>
<p>To improve our result, we need to add lighting to the scene. There're a few common types of lighting used in 3D graphics:</p>
<ul>
<li>Ambient light: inherent light effect of objects when there isn't external light source. The dot we used in the previous code can be considered as some sort of ambient light.</li>
<li>Directional light: light of same intensity shining in parallel along one direction, like sun light.</li>
<li>Point light: light shining from a point in 3D space, intensity is usually modeled <a href="https://en.wikipedia.org/wiki/Inverse-square_law">the inverse-square law</a>.</li>
</ul>
<p>For simplicity we will implement directional light for our PoC, but point light is also simple enough and is left as a homework :)</p>
<div class="highlight">
    <pre class="code" data-lang="rust"><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Light</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">d</span>: <span class="nc">Vec3</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">intensity</span>: <span class="kt">f32</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Light</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_luminance</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>: <span class="nc">Vec3</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">char</span> <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">lum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">lum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">intensity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">d</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">index</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="sc">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;~&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;:&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;=&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="sc">&#39;!&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;*&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;#&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;$&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;@&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;M&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lum</span><span class="p">.</span><span class="n">min</span><span class="p">(</span><span class="mf">0.99</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">f32</span><span class="p">)).</span><span class="n">floor</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre>
</div><p>Only one function <code>get_luminance</code> is needed for the <code>Light</code> object, where we use the normal vector of the intersection point to compute the luminance of that pixel: only when the normal is &quot;facing&quot; the light direction will it have a positive luminance<sup class="footnote-ref" id="fnref-3"><a href="#fn-3">3</a></sup>.</p>
<p>With this, we can pass a <code>Light</code> object into player, and properly use it when updating each pixel with an intersection to any triangle:</p>
<div class="highlight">
    <pre class="code" data-lang="rust"><span></span><code><span class="c1">// Replacing self.a[i][j] = &#39;.&#39;;</span>
<span class="bp">self</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">light</span><span class="p">.</span><span class="n">get_luminance</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
</code></pre>
</div><p>With <a href="https://github.com/KevinXuxuxu/cosmo/tree/lite_v2/rust_lite">this branch</a> of the code, we can get a render that makes more sense:</p>
<p><p style="text-align: center"><img class="my-resp-img" src="/static/image/cosmo_light_cube.png" alt="cosmo_light_cube" style="width: 40%"/><br><em class="text-gray">Hey, it looks pretty cubical if you take the glasses off!</em></p></p>
<h4 id="rotation">Rotation&nbsp;<a class="hidden" tabindex="-1" href="#rotation" style="font-size: .8rem"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 8 8"><path fill="currentColor" d="M5.88.03a1.9 1.9 0 0 0-.53.09c-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22c.35-.12.78-.07 1.06.22c.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47c-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5A1.98 1.98 0 0 0 6.44.07C6.26.03 6.06.03 5.88.04zm-2 2.31c-.5-.02-1.19.15-1.78.75L.6 4.59a1.98 1.98 0 0 0 0 2.81c.56.56 1.36.72 2.06.47c.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22c-.35.12-.78.07-1.06-.22c-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44c.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"/></svg></a></h4>
<p>Now that we have a correctly rendered cube, the last step is to make it move. Generally a <a href="https://en.wikipedia.org/wiki/Rotation_matrix#General_3D_rotations">rotation matrix</a> is used based on the axis and radian of the desired rotation, but for simplicity we will just use the simple matrix which rotates around <span class="math">\(z\)</span> axis:</p>
<div class="math">$$
R_z(\alpha) = \begin{pmatrix}
\cos\alpha & -\sin\alpha & 0\\
\sin\alpha & \cos\alpha & 0\\
0 & 0 & 1
\end{pmatrix}
$$</div>
<p>For any point <span class="math">\(P = (x, y, z)^T\)</span>, the new point <span class="math">\(P'\)</span> after rotation can be found by simply doing matrix multiplication:</p>
<div class="math">$$
P' = R_z(\alpha) P
$$</div>
<p>With the theory, we add a util function <code>rotate_z</code> which takes in the radian rotated per second, the time taken for each frame (<code>dt</code>) and a <code>Vec3</code> point to be processed in-place.</p>
<div class="highlight">
    <pre class="code" data-lang="rust"><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">rotate_z</span><span class="p">(</span><span class="n">rad</span>: <span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span>: <span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="n">p</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Vec3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rad</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vec3</span>::<span class="n">new</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">cos</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">sin</span><span class="p">(),</span><span class="w"></span>
<span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">sin</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">cos</span><span class="p">(),</span><span class="w"></span>
<span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre>
</div><p>The rotation function (especially a generalized one) would be quite useful, for example supporting a camera of any angle (or even moving camera). For now we just need to use it in the <code>Triangle</code> struct as an update process, and call it from the update process of <code>Player</code>:</p>
<div class="highlight">
    <pre class="code" data-lang="rust"><span></span><code><span class="c1">// In triangle.rs</span>

<span class="c1">// Don&#39;t forget to add rad: f32 as an attribute</span>
<span class="c1">// and properly initialize it.</span>
<span class="k">impl</span><span class="w"> </span><span class="n">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">update</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span>: <span class="kt">f32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">rotate_z</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">rad</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">rotate_z</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">rad</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">rotate_z</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">rad</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">c</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Re-compute normal vector</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">a</span><span class="p">).</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">a</span><span class="p">).</span><span class="n">normalize</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// In player.rs</span>
<span class="k">impl</span><span class="w"> </span><span class="n">Player</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">update</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">triangles</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">t</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">dt</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Other logics in update...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre>
</div><p>With <a href="https://github.com/KevinXuxuxu/cosmo/tree/lite_v3/rust_lite">this version</a>, we finally achieved our goal: a spinning cube. Feel free to play around the camera/light parameter, implement other types of camera/lighting/objects. It's really fun and rewarding.</p>
<pre><code class="cosmo-display" scene="cube" dimension="60,30" framerate="24" enable-aabb=false disable-shade=false>loading failed, try refresh UwU</code></pre>
<h4 id="afterword">Afterword&nbsp;<a class="hidden" tabindex="-1" href="#afterword" style="font-size: .8rem"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 8 8"><path fill="currentColor" d="M5.88.03a1.9 1.9 0 0 0-.53.09c-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22c.35-.12.78-.07 1.06.22c.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47c-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5A1.98 1.98 0 0 0 6.44.07C6.26.03 6.06.03 5.88.04zm-2 2.31c-.5-.02-1.19.15-1.78.75L.6 4.59a1.98 1.98 0 0 0 0 2.81c.56.56 1.36.72 2.06.47c.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22c-.35.12-.78.07-1.06-.22c-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44c.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"/></svg></a></h4>
<p>Although this is quite different from the current implementation of <a href="https://github.com/KevinXuxuxu/cosmo">cosmo</a>, the core idea is almost the same, and you can build on top of this in anyway you see fit.</p>
<p>In the next post I will talk more about my current implementation, including some of the &quot;fancy stuffs&quot; I was trying to pull off, like how to create shadow? How does one object block another? What to do when there're too many objects in the scene and we hit performance issue?</p>
<p>Hope you enjoyed and happy hacking :)</p>
<section class="footnotes">
<ol>
<li id="fn-1"><p>This is quite an over simplification. In formal computer vision study we should use something like a <a href="https://en.wikipedia.org/wiki/Camera_matrix">camera matrix</a>, which takes in a point in space with homogeneous coordinates, and directly computes the corresponding position on the film of the camera.<a href="#fnref-1" class="footnote">&#8617;</a></p></li>
<li id="fn-2"><p>It gets more complicated when you have multiple objects and each object consists of so many triangles. Tune in for next post :)<a href="#fnref-2" class="footnote">&#8617;</a></p></li>
<li id="fn-3"><p>The luminance index is an adaptation of Andy's version in <a href="https://www.a1k0n.net/2006/09/15/obfuscated-c-donut.html">the original &quot;donut&quot; code</a>: <code>.,-~:;=!*#$@</code><a href="#fnref-3" class="footnote">&#8617;</a></p></li>
</ol>
</section>


<i><a class="text-secondary" style="font-size: .7rem;"
        href="https://github.com/KevinXuxuxu/blog/blob/main/posts/cosmo:-3D-Graphics-Engine-in-Terminal-(Cont.).md">Markdown source</a></i>

<script src="https://giscus.app/client.js" data-repo="KevinXuxuxu/KevinXuxuxu.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzNjU0MjE0Ng==" data-category="Announcements"
    data-category-id="DIC_kwDOAi2Wws4Cna5N" data-mapping="title" data-strict="0" data-reactions-enabled="1"
    data-emit-metadata="0" data-input-position="bottom" data-theme="catppuccin_mocha" data-lang="en" data-loading="lazy"
    crossorigin="anonymous" async>
    </script>

            </div>
            <div class="column col-sm-12 col-md-2 col-4">
                
                
            </div>
        </main>
    </div>
</body>

</html>