<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Fangzhou Xu,kevin.xu.fangzhou@gmail.com"><title>pyquery 大法好 · Kevin Xu</title><meta name="description" content="昨天考了两门数学课的期中考试，一共将近四个小时。既然我对自己的菜很有自觉，就不会设定太高的期望，所以心态还算平稳。唯一有点尴尬的就是我花了长时间准备的考试反而不如没怎么准备的，已经 Pass/Fail 的课。不过应该都能及格就是了（
下午睡了不到一个半小时，感觉恢复不过来，就起来做作业了。这次的 1"><meta name="keywords" content="Python,Coding"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:150px;"><h3 title=""><a href="/">Kevin Xu</a></h3><div class="description"><p>Entry level coder in sillicon valley, Otaku.</p></div></div></div><ul class="social-links"><li><a href="https://twitter.com/OrikiXu"><i class="fa fa-twitter"></i></a></li><li><a href="http://weibo.com/1970882853"><i class="fa fa-weibo"></i></a></li><li><a href="http://facebook.com/kevin.xu.1272010"><i class="fa fa-facebook"></i></a></li><li><a href="http://github.com/KevinXuxuxu"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/category">分类/标签</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/images/logo.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>pyquery 大法好</a></h3></div><div class="post-content"><ul>
<li>昨天考了两门数学课的期中考试，一共将近四个小时。既然我对自己的菜很有自觉，就不会设定太高的期望，所以心态还算平稳。唯一有点尴尬的就是我花了长时间准备的考试反而不如没怎么准备的，已经 Pass/Fail 的课。不过应该都能及格就是了（</li>
<li>下午睡了不到一个半小时，感觉恢复不过来，就起来做作业了。这次的 18656 作业还蛮有意思，是做 HTML Parsing 的，附带上 Neo4j query （不过不重要）。之前曾经试图自己用 <code>re</code> 和 <code>requests</code> 自己做爬虫去爬 steam 上的游戏（，这次学习了新的技巧：<code>pyquery</code>。</li>
<li><code>pyquery</code> 基本上就是一个 Python 的 jQuery package。像我这种前端屑完全不怎么懂 jQuery，摸爬滚打了很久才搞明白要怎么用。当然结果上来讲肯定是比用 <code>re</code> 来的方便的（废话）。</li>
</ul>
<h4 id="pyquery"><a href="#pyquery" class="headerlink" title="pyquery"></a>pyquery</h4><ul>
<li><p>上一段示例代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_google</span><span class="params">(query)</span></span></div><div class="line">    d = pq(url="http://www.google.com/search?q=" + query.replace(' ', '+'))</div><div class="line">    results = []</div><div class="line">    p = re.compile(<span class="string">"q=(.+?)&amp;"</span>)</div><div class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> d(<span class="string">".g"</span>):</div><div class="line">        href = g.find(<span class="string">"./h3/a"</span>).attrib[<span class="string">'href'</span>]</div><div class="line">        match = re.findall(p, href)</div><div class="line">        results.append(&#123;</div><div class="line">            <span class="string">'r'</span>: g.find(<span class="string">"./h3/a"</span>).text_content(),</div><div class="line">            <span class="string">'href'</span>: match[<span class="number">0</span>] <span class="keyword">if</span> match <span class="keyword">else</span> href,</div><div class="line">            <span class="string">'s'</span>: g.find(<span class="string">"./div"</span>).text_content()&#125;)</div><div class="line">    <span class="keyword">return</span> results</div></pre></td></tr></table></figure>
</li>
<li><p>调用 <code>pq(url)</code> 会生成一个类似 <code>jQuery</code> 里面 document 一样的东西。然后直接在 <code>d()</code> 上做函数调用，输入的字符串会被用作 Selector 来选取元素，具体的用法可以参考下面的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">d(<span class="string">'.g'</span>) <span class="comment"># elements with class="g"</span></div><div class="line">d(<span class="string">'.entry.inproceedings'</span>) <span class="comment"># elements with class="entry inproceedings"</span></div><div class="line">d(<span class="string">'#name1'</span>) <span class="comment"># elements with id="name1"</span></div><div class="line">d(<span class="string">'img'</span>) <span class="comment"># all &lt;img&gt; tags</span></div><div class="line">d(<span class="string">'div.ppp'</span>) <span class="comment"># &lt;div&gt; tags with class="ppp"</span></div><div class="line">d(<span class="string">'*'</span>) <span class="comment"># all elements</span></div></pre></td></tr></table></figure>
</li>
<li><p>选取出来的元素是 <code>HtmlElement</code> 类型，可以在它们的基础上继续进行选择，不过我没有找到递归使用 selector 的方法（），要用另一种方法来 查找元素：<code>e.find()</code> 或者 <code>e.findall()</code>，参数是一个描述目标元素的 XPath。真的没想到 18655 学的 XML 知识竟然会有用，震惊。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">e.find(<span class="string">".//span[@class='title']"</span>) <span class="comment"># sub tag in any depth with class="title"</span></div><div class="line">e.findall(<span class="string">".//span[@itemprop='author']/a/span[@itemprop='name']"</span>)</div><div class="line">e.find(<span class="string">"./h3/a"</span>) <span class="comment"># trivial</span></div><div class="line">e.text <span class="comment"># returns text content only when e is leaf node, None otherwise</span></div><div class="line">e.text_content() <span class="comment"># returns text of everything inside tag</span></div><div class="line">e.attrib <span class="comment"># dictionary of tag attributes</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="其他的"><a href="#其他的" class="headerlink" title="其他的"></a>其他的</h4><ul>
<li>因为页面设计的自由度太高，这次作业中有很多比较“无理”的要求，我尽我所能的尝试了一些方法达成目标：<ul>
<li>从文章作者的名字和 Affiliation 找到个人主页：用 google search，在第一页的结果里排除掉 Google 和 Linkedin 的结果，从剩下的里面优先挑选教育网（.edu）链接。</li>
<li>在主页上获得照片：这个感觉不用图像识别是没法做的嘛。我先排除了 <code>src</code> 里含有 logo 和 .gif 的图片（没有人会用 gif 做头像吧…)，然后从剩下的里面优先挑选含有 head 的链接。大概能达到 60% 的 precesion（？</li>
<li>在主页上获得研究方向：…完全没有想法，最后直接在所有网页元素里搜索 interest，然后输出了之后的几个元素的文本，希望里面能包含着研究方向吧…</li>
</ul>
</li>
</ul>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-11-01</span><i class="fa fa-comment-o"></i><a href="/2017/11/01/pyquery 大法好/#comments">评论</a><i class="fa fa-tag"></i><a href="/categories/tech/" title="tech" class="tag">tech </a><a href="/tags/index/" title="index" class="tag">index </a><a href="/tags/Python/" title="Python" class="tag">Python </a><a href="/tags/tutorial/" title="tutorial" class="tag">tutorial </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://KevinXuxuxu.github.io/2017/11/01/pyquery 大法好/,Kevin Xu,pyquery 大法好,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2017/11/11/111017/" title="111017" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2017/10/24/102317/" title="102317" class="btn">下一篇</a></li></ul></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = 'kevinxu-1';
var disqus_identifier = '2017/11/01/pyquery 大法好/';
var disqus_title = 'pyquery 大法好';
var disqus_url = 'http://KevinXuxuxu.github.io/2017/11/01/pyquery 大法好/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//kevinxu-1.disqus.com/count.js" async></script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>